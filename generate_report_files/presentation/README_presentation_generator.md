# Генератор презентаций

Скрипт для автоматического создания презентаций на основе данных кампаний Яндекс.Директ из отчетов.

## Установка зависимостей

```bash
pip install -r requirements.txt
```

## Настройка

Создайте файл `.env` в корне проекта со следующими переменными:

```env
# Настройки подключения к базе данных PostgreSQL
DB_HOST=localhost
DB_PORT=5432
DB_NAME=your_database_name
DB_USER=your_username
DB_PASSWORD=your_password

# Настройки MinIO
S3_ENDPOINT_URL=minio.upk-mos.ru
S3_ACCESS_KEY=your_access_key
S3_SECRET_KEY=your_secret_key
S3_SECURE=False
S3_BUCKET_NAME=dit-services-dev
```

## Запуск

```bash
python presentation_generator.py
```

## Как работает скрипт

1. **Получение отчетов**: Скрипт получает из БД все отчеты со статусом 1 (готовые к обработке)

2. **Загрузка данных**: Для каждого отчета загружается файл `campaigns.json` из MinIO

3. **Фильтрация кампаний**: Из всех кампаний отбираются только:
   - Кампании, указанные в заявке (поле `campany_yandex_direct`)
   - Кампании типа РСЯ (в названии содержится `/РСЯ/`)

4. **Создание презентации**: Для каждой РСЯ-кампании создается слайд с заголовком:
   - Формат: "Текстово-графические объявления РСЯ: [подназвание]"
   - Шрифт: Times New Roman, 16 кегль
   - Цвет: черный
   - Расположение: с отступом сверху и слева

5. **Сохранение**: Презентация сохраняется в файл `presentation_report_{report_id}.pptx`

## Пример

Если в базе есть кампания с названием:
```
Карта москвича/РСЯ/Брендовые ключи
```

То на слайде будет создан заголовок:
```
Текстово-графические объявления РСЯ: Брендовые ключи
```

## Структура базы данных

Скрипт использует следующие таблицы:
- `reports` - отчеты со статусом обработки
- `requests` - заявки с информацией о кампаниях
- `contracts` - договоры

## Структура MinIO

Файлы кампаний должны находиться по пути:
```
gen_report_context_contracts/data_yandex_direct/{report_id}_результаты/campaigns.json
```

